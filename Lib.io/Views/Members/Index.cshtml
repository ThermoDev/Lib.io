@model List<Lib.io.Models.Member>
<h1>Members</h1>

@if (Model.Count == 0) {
    <text>A member has not rented a book yet.</text>
}
else {
    <table id="members" class="table table-bordered">
        <thead>
            <tr>
                <th>Member</th>
                <th>Discount Rate</th>
                <th>Membership Type</th>
                <th>Delete</th>
            </tr>
        </thead>
        @foreach (var member in Model) {
            <tr>
                <td>
                    @Html.ActionLink(member.Name, "Edit", "Members", new { Id = member.Id }, null)
                </td>
                <td>
                    @member.MembershipType.DiscountRate%
                </td>
                <td>
                    @member.MembershipType.Name
                </td>
                <td>
                    <button data-member-id="@member.Id" class="btn-link js-delete">Delete</button>
                </td>
            </tr>
        }
    </table>
}
@section scripts {
    <script>
        $(document).ready(() => {
            $("#members").on("click", ".js-delete", function () {
                let button = $(this);

                bootbox.confirm("Are you sure you want to delete this customer?", (result) => {
                    if (result) {
                        $.ajax({
                            url: "/api/members/" + button.attr("data-member-id"),
                            method: "DELETE",
                            success: () => {
                                button.parents("tr").remove();
                            }
                        })
                    }
                });
            })
        });
    </script>
}